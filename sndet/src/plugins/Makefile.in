SHELL = /bin/sh
CC = @CC@
CTAGS = ctags -R
INSTALLCMD = @INSTALL@

srcdir=@srcdir@
prefix=@prefix@
includedir=@includedir@
exec_prefix=@exec_prefix@
bindir=@bindir@
sbindir=@sbindir@
libdir=@libdir@
mandir=@mandir@

pluginsdir=${libdir}/sniffdet/plugins

DESTDIR=

LIBNET_OPTIONS=@LIBNET_DEFINES@

CFLAGS = @CFLAGS@ $(LIBNET_OPTIONS)

LIBS = @LIBS@

INCLUDES = -I..

all: do-it-all plugins

ifeq (.depend,$(wildcard .depend))
include .depend
do-it-all:
else
#do-it-all: .depend
do-it-all:
endif

.c.o:
	$(CC) $(CFLAGS) $(DEBUG_OPTIONS) $(INCLUDES) -fpic -c -o $@ $<

.o.so:
	$(CC) $(CFLAGS) $(DEBUG_OPTIONS) $(INCLUDES) -shared -lc -o $@ $<

plugins: null.so stdout.so xml.so

install: plugins
	$(INSTALLCMD) -d -m 0755 $(DESTDIR)${pluginsdir}
	$(INSTALLCMD) null.so $(DESTDIR)${pluginsdir}
	$(INSTALLCMD) stdout.so $(DESTDIR)${pluginsdir}
	$(INSTALLCMD) xml.so $(DESTDIR)${pluginsdir}

.depend dep:
	for i in *.c; do $(CPP) -M $(LIBNET_OPTIONS) $$i; done > .depend

tags:
	$(CTAGS)

clean:
	rm -f *.o *.so

distclean: clean
	rm -f .depend Makefile

.PHONY: all clean dep distclean tags
.SUFFIXES: .c .o .so
