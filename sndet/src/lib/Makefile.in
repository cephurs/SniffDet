SHELL = /bin/sh
CC = @CC@
CTAGS = ctags -R
INSTALLCMD = @INSTALL@
LIBNET_OPTIONS = @LIBNET_DEFINES@

srcdir=@srcdir@
prefix=@prefix@
includedir=@includedir@
exec_prefix=@exec_prefix@
bindir=@bindir@
sbindir=@sbindir@
libdir=@libdir@
mandir=@mandir@

DESTDIR=

CFLAGS = @CFLAGS@ $(LIBNET_OPTIONS)

LIBS = @LIBS@

all: do-it-all libsniffdet.a

ifeq (.depend,$(wildcard .depend))
include .depend
do-it-all:
else
#do-it-all: .depend
do-it-all:
endif

OBJECTS = icmptest.o latencytests.o arptest.o dnstest.o init.o helpers.o ping.o

libsniffdet.a: $(OBJECTS)
	ar rcs $@ $(OBJECTS)

test: test.o $(OBJECTS)
	$(CC) $(CFLAGS) $(DEBUG_OPTIONS) $< $(OBJECTS) -o $@ $(LIBS)

.c.o:
	$(CC) $(CFLAGS) $(DEBUG_OPTIONS) -c -o $@ $<

.depend dep:
	for i in *.c; do $(CPP) -M $(LIBNET_OPTIONS) $$i; done > .depend

install: libsniffdet.a
	${INSTALLCMD} -d -m 755 $(DESTDIR)${libdir}
	${INSTALLCMD} -d -m 755 $(DESTDIR)${includedir}
	${INSTALLCMD} -m 644 libsniffdet.a $(DESTDIR)${libdir}
	${INSTALLCMD} -m 644 libsniffdet.h $(DESTDIR)${includedir}

tags:
	$(CTAGS)

clean:
	rm -f *.o *.a core.* core test libsniffdet.a

distclean: clean
	rm -f config.h .depend Makefile

.PHONY: all clean dep distclean tags
.SUFFIXES: .c .o
